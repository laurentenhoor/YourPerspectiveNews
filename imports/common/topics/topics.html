<div class="scroll-window" id="scroll-{{topic._id}}" ng-repeat="topic in $ctrl.topics | orderBy:'-createdAt'"
 ng-init="topic.selectedArticle = {}">

	<div class="scroll-container">
	
		<topic-controls></topic-controls>
		<!-- <topic-summary></topic-summary> -->

		<div class="content-container" ng-repeat="categoryBlock in topic.articlesByCategory | orderBy:'sortingOrder'" ng-show="articles.length>0"
		 ng-init="
			categoryName=categoryBlock.category; 
			articles=$ctrl.getArticlesByIds(categoryBlock.articleIds);
			topic.selectedArticle[categoryName]=$ctrl.getArticleWithHighestScore(articles);
			$ctrl.loadedArticles= $ctrl.loadedArticles.concat(categoryBlock.articleIds);
			articleId = topic.selectedArticle[categoryName]._id;
			">

			<!-- <topic-item></topic-item> -->

			<div class="bulletin-item-header">{{categoryName}}</div>

			<div class="bulletin-item-image-and-details-container">

				<div class="bulletin-item-image-container">

					<div class="bulletin-item-controls-container">
						<div class="bulletin-item-icons">

							<div class="">
								<i class="material-icons comment-icon" ng-click="$ctrl.clickChat(topic._id)">
									&#xE24C;</i>
								<!-- insert_comment -->
								<a href="whatsapp://send?text=http://beta.jouwpers.nl/" data-action="share/whatsapp/share" tabindex="0">
									<i class="material-icons share-icon">&#xE80D;</i>
									<!-- share -->
								</a>

							</div>
							<yourpers-article-actions topic-id="topic._id" category="categoryBlock" article="topic.selectedArticle[categoryName]" class="bulletin-edit-icon">
							</yourpers-article-actions>

						</div>

						<div class="bulletin-voting" ng-init="" ng-if="true">

							<div ng-click="$ctrl.vote(topic.selectedArticle[categoryName],1)" class="bulletin-arrow-up" ng-class="{true: 'bulletin-upvoted', false: ''}[$ctrl.userVoteMap[articleId]==1]">
							</div>

							<div class="bulletin-vote-score">
								{{$ctrl.articlesScoreMap[articleId] || 0}}
							</div>

							<div ng-click="$ctrl.vote(topic.selectedArticle[categoryName],-1)" class="bulletin-arrow-down" ng-class="{true: 'bulletin-downvoted', false: ''}[$ctrl.userVoteMap[articleId]==-1]">
							</div>

						</div>
					</div>

					<div class="bulletin-item-image" ng-style="{'background-image':'url(\'' + (topic.selectedArticle[categoryName].imageUrl) + '\')'}"
					 style="background-color:{{ topic.selectedArticle[categoryName].videoUrl ? 'black' : 'rgb(187, 187, 187)' }}">
					</div>

					<iframe class="bulletin-video-player-iframe" ng-if="topic.selectedArticle[categoryName].videoUrl" src="{{topic.selectedArticle[categoryName].videoUrl}}"
					 allowfullscreen>
					</iframe>

					<div class="solid-overlay">
					</div>

					<div ng-click="$ctrl.openExternalUrl(topic.selectedArticle[categoryName]);" ng-class="topic.selectedArticle[categoryName].videoUrl ? 'link-disabled' : ''"
					 ng-hide="topic.selectedArticle[categoryName].videoUrl">

						<div class="bulletin-item-title-container">

							<div class="bulletin-item-title" ng-class="{'bulletin-visited' : (articleId == $ctrl.visitedId)}">
								{{topic.selectedArticle[categoryName].title}}
							</div>

							<div class="bulletin-item-publisher">
								{{topic.selectedArticle[categoryName].publisher}}
							</div>

							<div class="bulletin-time-elapsed">
								{{ $ctrl.getTimeTag(topic.selectedArticle[categoryName]) }}
							</div>

						</div>
					</div>

				</div>

				<!-- 			<a href="{{topic.selectedArticle[categoryName].url || ''}}"  -->
				<!-- 				target="_self"  -->
				<!-- 				class="{{topic.selectedArticle[categoryName].videoUrl ? 'link-disabled' : ''}}"> -->
				<div class="bulletin-item-description" ng-if="topic.selectedArticle[categoryName].description" ng-click="toggle = !toggle"
				 ng-class="{'auto-height' : toggle}">
					{{topic.selectedArticle[categoryName].description}}
				</div>
				<!-- 			</a> -->

				<div class="bulletin-sources">

					<yourpers-article-actions topic-id="topic._id" category="categoryBlock" class="add-article-from-bulletin-item">
					</yourpers-article-actions>

					<div class="bulletin-source" ng-repeat="article in articles | orderBy:'-score'" ng-click="$ctrl.clickArticle(topic, categoryName, article)"
					 ng-class="(article._id == articleId) ? 'bulletin-source-selected':''" ng-style="{'background-image':'url(\'' + (article.logoUrl) + '\')'}">
					</div>
				</div>

			</div>

		</div>

		<topic-discussion></topic-discussion>
		<topic-opinion></topic-opinion>

		<div class="content-container" id="discuss-{{topic._id}}">

			<div class="bulletin-item-header">Jouw perspectief</div>

			<div class="bulletin-item-image-and-details-container bulletin-community">

				<yourpers-comments topic-id="topic._id">
				</yourpers-comments>

			</div>

		</div>

	</div>
</div>