<div class="content-container" 
    ng-repeat="categoryBlock in $ctrl.topic.articlesByCategory | orderBy:'sortingOrder'" 
    ng-init="
           articles = $ctrl.getArticlesByIds(categoryBlock.articleIds);
           selectedArticle = {};
           categoryName = categoryBlock.category; 
           selectedArticle[categoryName] = $ctrl.getArticleWithHighestScore(articles);
           $ctrl.loadedArticles = $ctrl.loadedArticles.concat(categoryBlock.articleIds);
           "
        ng-show="articles.length > 0">

    <div class="bulletin-item-header">{{categoryName}}</div>

    <div class="bulletin-item-image-and-details-container">

        <div class="bulletin-item-image-container">

            <div class="bulletin-item-controls-container">

                <vote class="bulletin-voting"
                    article-id="selectedArticle[categoryName]._id">
                </vote>

            </div>

            <div class="bulletin-item-image" ng-style="{'background-image':'url(\'' + (selectedArticle[categoryName].imageUrl) + '\')'}"
                style="background-color:{{ selectedArticle[categoryName].videoUrl ? 'black' : 'rgb(187, 187, 187)' }}">
            </div>

            <iframe class="bulletin-video-player-iframe" ng-if="selectedArticle[categoryName].videoUrl" src="{{selectedArticle[categoryName].videoUrl}}"
                allowfullscreen>
            </iframe>

            <div class="solid-overlay">
            </div>

            <div ng-click="$ctrl.openExternalUrl(selectedArticle[categoryName]);" ng-class="selectedArticle[categoryName].videoUrl ? 'link-disabled' : ''"
                ng-hide="selectedArticle[categoryName].videoUrl">

                <div class="bulletin-item-title-container">

                    <div class="bulletin-item-title" ng-class="{'bulletin-visited' : (selectedArticle[categoryName]._id == $ctrl.visitedId)}">
                        {{selectedArticle[categoryName].title}}
                    </div>

                    <div class="bulletin-item-publisher">
                        {{selectedArticle[categoryName].publisher}}
                    </div>

                    <div class="bulletin-time-elapsed">
                        {{ selectedArticle[categoryName].publishedAt || selectedArticle[categoryName].updatedAt | timeFromNow }}
                    </div>

                </div>
            </div>

        </div>

        <div class="bulletin-item-description" ng-if="selectedArticle[categoryName].description" 
            ng-click="toggle = !toggle" ng-class="{'auto-height' : toggle}">
            {{selectedArticle[categoryName].description}}
        </div>

        <div class="bulletin-sources">

            <article-actions-button topic-id="$ctrl.topic._id" category="categoryBlock" article="selectedArticle[categoryName]" class="edit-article-from-topics">
            </article-actions-button>

            <div class="bulletin-source" ng-repeat="article in articles | orderBy:'-score'" ng-click="selectedArticle[categoryName] = article"
                ng-class="(article._id == selectedArticle[categoryName]._id) ? 'bulletin-source-selected':''" ng-style="{'background-image':'url(\'' + (article.logoUrl) + '\')'}">
            </div>
            
        </div>

    </div>

</div>